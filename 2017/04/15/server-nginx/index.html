<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 配置服务器 —— Nginx的安装和配置 · Lin's Blog</title><meta name="description" content="配置服务器 —— Nginx的安装和配置 - Linbin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.lbinin.com/atom.xml" title="Lin's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/lbinin" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">配置服务器 —— Nginx的安装和配置</h1><div class="post-info">Apr 15, 2017</div><div class="post-content"><h2 id="Nginx安装："><a href="#Nginx安装：" class="headerlink" title="Nginx安装："></a>Nginx安装：</h2><p><strong><em>下载解压安装</em></strong></p>
<hr>
<p>进入Nginx官网站 <a href="http://nginx.org/" target="_blank" rel="external">http://nginx.org/</a>，进入后选择最新的版本，进入页面后在 <code>Stable version</code> 中选择 <code>nginx-*</code> 右键复制链接，然后用 <code>wget</code> 下载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># wget http://nginx.org/download/nginx-1.12.0.tar.gz</span></div></pre></td></tr></table></figure>
<p>如果提示wget命令未找到，则执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># sudo yum install wget</span></div></pre></td></tr></table></figure>
<p>下载完用 <code>ll</code> 命令查看刚刚下载获得的 <code>nginx-*.tar.gz</code> 文件，用下面命令解压它</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># tar -zxvf nginx-1.12.0.tar.gz</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<blockquote>
<p><strong>-z</strong>: 表示使用gzip的属性。<br><strong>-x</strong>: 解开一个压缩文件的参数指令。<br><strong>-v</strong>: 表示压缩的过程中显示文件！这个常用，但不建议用在背景执行过程！<br><strong>-f</strong>: 使用档名，请留意，在 f 之后要立即接档名喔！不要再加参数！</p>
<p><a href="http://jingyan.baidu.com/article/86112f13605d30273697876e.html?st=2&amp;os=0&amp;bd_page_type=1&amp;net_type=1" target="_blank" rel="external">参考资料</a></p>
</blockquote>
<hr>
<p>安装Nginx前，需要安装以下三个依赖包：</p>
<ol>
<li><p>gzip 模块需要 <code>zlib</code> 库</p>
</li>
<li><p>rewrite 模块需要 <code>pcre</code> 库</p>
</li>
<li><p>ssl 功能需要 <code>openssl</code> 库</p>
</li>
</ol>
<p><a href="https://www.openssl.org/source/" target="_blank" rel="external">https://www.openssl.org/source/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># wget https://www.openssl.org/source/openssl-fips-2.0.14.tar.gz</span></div></pre></td></tr></table></figure>
<p><a href="http://www.zlib.net/" target="_blank" rel="external">http://www.zlib.net/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># wget http://www.zlib.net/zlib-1.2.11.tar.gz</span></div></pre></td></tr></table></figure>
<p>(<a href="http://www.pcre.org/)[http://www.pcre.org/" target="_blank" rel="external">http://www.pcre.org/)[http://www.pcre.org/</a>]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.39.tar.gz</span></div></pre></td></tr></table></figure>
<p>下载完成后安装，依赖包安装顺序依次为: <code>openssl</code>、<code>zlib</code>、<code>pcre</code>, 然后安装 <code>Nginx</code> 包</p>
<hr>
<p>1.安装openssl</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># tar -zxvf openssl-fips-2.0.14.tar.gz </span></div><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># cd openssl-fips-2.0.14/</span></div><div class="line">[root@iZ2844brz0xZ openssl-fips-2.0.14]<span class="comment"># ./config </span></div><div class="line">[root@iZ2844brz0xZ openssl-fips-2.0.14]<span class="comment"># make</span></div><div class="line">[root@iZ2844brz0xZ openssl-fips-2.0.14]<span class="comment"># make install</span></div></pre></td></tr></table></figure>
<p>2.安装zlib</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># tar -zxvf zlib-1.2.11.tar.gz </span></div><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># cd zlib-1.2.11/</span></div><div class="line">[root@iZ2844brz0xZ zlib-1.2.11]<span class="comment"># ./configure </span></div><div class="line">[root@iZ2844brz0xZ zlib-1.2.11]<span class="comment"># make</span></div><div class="line">[root@iZ2844brz0xZ zlib-1.2.11]<span class="comment"># make install</span></div></pre></td></tr></table></figure>
<p>3.安装pcre</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># tar -zxvf pcre-8.39.tar.gz </span></div><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># cd pcre-8.39/</span></div><div class="line">[root@iZ2844brz0xZ pcre-8.39]<span class="comment"># ./configure </span></div><div class="line">[root@iZ2844brz0xZ pcre-8.39]<span class="comment"># make</span></div><div class="line">[root@iZ2844brz0xZ pcre-8.39]<span class="comment"># make install</span></div></pre></td></tr></table></figure>
<p>4.安装nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># tar -zxvf nginx-1.12.0.tar.gz </span></div><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># cd nginx-1.12.0/</span></div><div class="line">[root@iZ2844brz0xZ nginx-1.12.0]<span class="comment"># ./configure --with-pcre=../pcre-8.39 --with-zlib=../zlib-1.2.11 --with-openssl=../openssl-fips-2.0.14</span></div><div class="line">[root@iZ2844brz0xZ nginx-1.12.0]<span class="comment"># make</span></div><div class="line">[root@iZ2844brz0xZ nginx-1.12.0]<span class="comment"># make install</span></div></pre></td></tr></table></figure>
<hr>
<p>检测是否安装成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ nginx-1.12.0]<span class="comment"># cd /usr/local/nginx/sbin/</span></div><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># ./nginx -t</span></div></pre></td></tr></table></figure>
<p>若出现下方信息表示安装成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nginx: the configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf syntax is ok</div><div class="line">nginx: configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</div></pre></td></tr></table></figure>
<p>最后一步：启动Nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># ./nginx</span></div></pre></td></tr></table></figure>
<p>查看端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># netstat -ntlp</span></div></pre></td></tr></table></figure>
<p>出现以下结果</p>
<p><img src="http://img.blog.csdn.net/20170415170211580?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvTEJpbmlu/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<hr>
<p>至此，Nginx安装结束</p>
<p>参考资料：</p>
<blockquote>
<p><a href="http://www.cnblogs.com/hzh19870110/p/6100661.html" target="_blank" rel="external">http://www.cnblogs.com/hzh19870110/p/6100661.html</a> <em>作者：grhlove123</em></p>
</blockquote>
<h2 id="配置php-fpm"><a href="#配置php-fpm" class="headerlink" title="配置php-fpm"></a>配置php-fpm</h2><p>进入php的 <code>sbin</code> 目录下启动 <code>php-fpm</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># cd /usr/local/php7/sbin/</span></div><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># ./php-fpm</span></div></pre></td></tr></table></figure>
<p>（若提示没有权限，在命令前加上 <code>sudo</code> 即可。）</p>
<p>发现提示下方信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[15-Apr-2017 17:06:21] ERROR: failed to open configuration file <span class="string">'/usr/local/php7/etc/php-fpm.conf'</span>: No such file or directory (2)</div><div class="line">[15-Apr-2017 17:06:21] ERROR: failed to load configuration file <span class="string">'/usr/local/php7/etc/php-fpm.conf'</span></div><div class="line">[15-Apr-2017 17:06:21] ERROR: FPM initialization failed</div></pre></td></tr></table></figure>
<p>告诉我们在 <code>/usr/local/php7/etc/</code> 目录下没有找到 <code>php-fpm.conf</code> 配置文件。</p>
<p>那我们进入对应文件夹查看文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># cd /usr/local/php7/etc/</span></div><div class="line">[root@iZ2844brz0xZ etc]<span class="comment"># ll</span></div></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">total 16</div><div class="line">-rw-r--r-- 1 root root 1239 Apr 15 07:33 pear.conf</div><div class="line">-rw-r--r-- 1 root root 4468 Apr 15 07:33 php-fpm.conf.default</div><div class="line">drwxr-xr-x 2 root root 4096 Apr 15 07:33 php-fpm.d</div></pre></td></tr></table></figure>
<p>发现 <code>php-fpm.conf</code> 多了一个 <code>default</code> 结尾，我们只需要把文件重新命名就好了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ etc]<span class="comment"># mv php-fpm.conf.default php-fpm.conf --利用mv移动命令更改名字</span></div></pre></td></tr></table></figure>
<p>重新进入php的 <code>sbin</code> 目录下启动 <code>php-fpm</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ etc]<span class="comment"># cd /usr/local/php7/sbin/</span></div><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># ./php-fpm</span></div></pre></td></tr></table></figure>
<p>这时候提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[15-Apr-2017 17:08:23] WARNING: Nothing matches the include pattern <span class="string">'/usr/local/php7/etc/php-fpm.d/*.conf'</span> from /usr/<span class="built_in">local</span>/php7/etc/php-fpm.conf at line 125.</div><div class="line">[15-Apr-2017 17:08:23] ERROR: No pool defined. at least one pool section must be specified <span class="keyword">in</span> config file</div><div class="line">[15-Apr-2017 17:08:23] ERROR: failed to post process the configuration</div><div class="line">[15-Apr-2017 17:08:23] ERROR: FPM initialization failed</div></pre></td></tr></table></figure>
<p>告诉我们在 <code>/usr/local/php7/etc/php-fpm.d/</code> 目录下没有找到 <code>.conf</code> 文件，问题出在125行，我们用vim编辑文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># vim /usr/local/php7/etc/php-fpm.conf</span></div></pre></td></tr></table></figure>
<p>进入后输入命令 <code>:125</code> 跳转到125行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">include=/usr/local/php7/etc/php-fpm.d/*.conf</div></pre></td></tr></table></figure>
<p>给我们的信息是要找 <code>php-fpm.d</code> 目录下的以 <code>.conf</code> 结尾的文件，输入<code>:q!</code> 退出，进入对应文件夹，查看文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># cd /usr/local/php7/etc/php-fpm.d/</span></div><div class="line">[root@iZ2844brz0xZ php-fpm.d]<span class="comment"># ll</span></div></pre></td></tr></table></figure>
<p>发现以下文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">total 20</div><div class="line">-rw-r--r-- 1 root root 18521 Apr 15 07:33 www.conf.default</div></pre></td></tr></table></figure>
<p>重命名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ php-fpm.d]<span class="comment"># mv www.conf.default www.conf</span></div></pre></td></tr></table></figure>
<p>回到 <code>sbin</code> 目录下重新启动 <code>php-fpm</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ php-fpm.d]<span class="comment"># cd /usr/local/php7/sbin/</span></div><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># ./php-fpm</span></div></pre></td></tr></table></figure>
<p>若没有提示信息表明php-fpm启动成功啦~</p>
<p>用以下命令查看fpm进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># ps aux | grep php-fpm</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h2><p>进入Nginx目录，编辑 <code>nginx.conf</code> 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ nginx]<span class="comment"># cd /usr/local/nginx/</span></div><div class="line">[root@iZ2844brz0xZ nginx]<span class="comment"># cd conf/</span></div><div class="line">[root@iZ2844brz0xZ conf]<span class="comment"># vim nginx.conf</span></div></pre></td></tr></table></figure>
<p>看到 <code>server</code> 模块下有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">            root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>这段表示所有的文件都会进入html这个目录下，我们现在编写与php相关的语句</p>
<p>在下面我们可以找到配置文件已经帮我们写好了我们只需要把前面的注释符号 <code>#</code> 去掉就好了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">location ~ \.php$ &#123;</div><div class="line">            root           html;</div><div class="line">            fastcgi_pass   127.0.0.1:9000;</div><div class="line">            fastcgi_index  index.php;</div><div class="line">            fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</div><div class="line">            include        fastcgi_params;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>输入<code>:wq</code> 保存退出</p>
<p>进入nginx的<code>html</code> 目录，新建一个文件测试一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ conf]<span class="comment"># cd ..</span></div><div class="line">[root@iZ2844brz0xZ nginx]<span class="comment"># cd html/</span></div><div class="line">[root@iZ2844brz0xZ html]<span class="comment"># vim test.php</span></div></pre></td></tr></table></figure>
<p>输入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	phpinfo();</div></pre></td></tr></table></figure>
<p>忘了说，修改完配置文件记得要重新启动nginx哦</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@iZ2844brz0xZ ~]<span class="comment"># cd /usr/local/nginx/sbin/</span></div><div class="line">[root@iZ2844brz0xZ sbin]<span class="comment"># ./nginx -s reload</span></div></pre></td></tr></table></figure>
<p>打开网址，运行成功~</p>
<hr>
<h2 id="附："><a href="#附：" class="headerlink" title="附："></a>附：</h2><blockquote>
<p><a href="https://segmentfault.com/a/1190000007322358" target="_blank" rel="external">Nginx和php-fpm的运行原理</a> <em>作者：zilu</em> （写的很棒~）</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2017/04/15/server-vsftpd/" class="prev">上一篇</a><a href="/2017/04/15/server-mysql/" class="next">下一篇</a><a href="javascript: history.go(-1);" class="next">返回</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://www.lbinin.com">Linbin</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>